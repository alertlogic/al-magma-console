import { TableListConfig, Widget as WidgetConfig, ZeroState, ZeroStateReason } from '@al/ng-visualizations-components';

enum Column {
  DeploymentName,
  HostName,
  VulnerabilityCount,
  WorstSeverity,
  DeploymentId,
  HostKey
}

export const mostVulnerableHostsBI = (response: {rows: any[][]}, item?: WidgetConfig): TableListConfig | ZeroState => {
  const hosts = response.rows;
  if (hosts.length === 0) {
    return {
      nodata: true,
      reason: ZeroStateReason.Zero,
    };
  }
  const severity = ['info', 'low', 'medium', 'high'];
  return {
    headers: [
      {name: 'Host Name', field: 'host_name', class: 'left'},
      {name: 'Count', field: 'count', class: 'right'},
      {name: 'Deployment', field: 'deployment_name', class: 'left'},
      {name: 'Worst Severity', field: 'status', class: 'left status'}
    ],
    body: hosts.map(host =>
      ({
        host_name: host[Column.HostName],
        count: host[Column.VulnerabilityCount],
        deployment_name: host[Column.DeploymentName],
        status: severity[host[Column.WorstSeverity]],
        recordLink: {
          deployment_id: host[Column.DeploymentId],
          host: host[Column.HostKey]
        }
      })),
  };
};
