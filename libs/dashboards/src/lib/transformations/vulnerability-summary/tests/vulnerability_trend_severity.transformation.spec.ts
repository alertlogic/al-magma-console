import * as Transformation from '../vulnerability_trend.transformation';
import { ZeroStateReason } from '@al/ng-visualizations-components';
import { SeverityCountSummaries } from '../../kalm.named_query_response.types';
import { getLocalShortDate } from '../../transformation.utilities';

describe('Vulnerability Trend Severity Transformation Test Suite:', () => {

  describe('when there are no results', () => {
    it('should return a zero state reason for no results', () => {
      const vulnerabilityTrendSummaries: SeverityCountSummaries = {
        rows: [],
      };

      const config = Transformation.vulnerabilityTrend(vulnerabilityTrendSummaries);
      expect(config).toEqual({
        nodata: true,
        reason: ZeroStateReason.Zero
      });
    });
  });
  describe('when there are results', () => {
    it('should return a correctly constructed Highcharts options object', () => {
      const vulnerabilityTrendSummaries: SeverityCountSummaries = {
        rows: [
          [
            "2019-08-13",
            {
              Medium: 14,
              High: 4
            }
          ],
          [
            "2019-08-12",
            {
              Medium: 17,
              High: 2
            }
          ]
        ]
      };

      const config = Transformation.vulnerabilityTrend(vulnerabilityTrendSummaries);

      expect(config).toEqual({
        title:  '',
        description: 'Count of Vulnerabilities',
        dateOptions: [
          getLocalShortDate(new Date('2019-08-13T00:00:00.000Z')),
          getLocalShortDate(new Date('2019-08-12T00:00:00.000Z'))
        ],
        series: [{
          name: 'Medium',
          data: [{
            x: 0,
            y: 14,
            percentage: 78
          }, {
            x: 1,
            y: 17,
            percentage: 89
          }],
          className: 'medium',
          legendIndex: 1
        }, {
          name: 'High',
          data: [{
            x: 0,
            y: 4,
            percentage:22
          }, {
            x: 1,
            y: 2,
            percentage: 11
          }],
          className: 'critical',
          legendIndex: 0
        }]
      });
    });
  });
});
