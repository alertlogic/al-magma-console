import { Widget as WidgetConfig, TableListConfig, ZeroStateReason } from '@al/ng-visualizations-components';
import { ExposuresQueryResponse } from '@al/assets-query';

// TODO - Need to provide a type for the response here...

export const mostSeenCVEs = (response: ExposuresQueryResponse, item?: WidgetConfig) => {

  const tableConfig: TableListConfig = {
    headers: [
      { name: 'CVE ID', field: 'id', class: 'left nowrap' },
      { name: 'Name', field: 'summary', class: 'left' },
      { name: 'Severity', field: 'status', class: 'left status' },
      { name: 'Count', field: 'count', class: 'right' },
      { name: '% of Open', field: 'percent', class: 'right' }
    ],
    body: []
  };
  const assets = response.exposures.assets;
  const totalCve = response.summary.severities.all;

  if(assets.length === 0) {
    return {
      nodata: true,
      reason: ZeroStateReason.Zero
    };
  }
  tableConfig.body = assets.map(asset => ({
    id: asset.cve,
    summary: asset.name,
    count: asset.asset_count,
    status: asset.severity,
    recordLink: {
      vulnerabilityId: asset.vulnerability_id
    },
    percent: `${Math.round((asset.asset_count / totalCve)  * 100)}%`
   }));

  return tableConfig;
};
