import { TableListConfig, Widget as WidgetConfig, ZeroState, ZeroStateReason } from '@al/ng-visualizations-components';

enum Column {
  DeploymentName,
  HostName,
  VulnerabilityCount,
  WorstSeverity
}

export const mostVulnerableHosts = (response: {rows: any[]}, item?: WidgetConfig): TableListConfig | ZeroState => {
  const hosts = response.rows;
  if (hosts.length === 0) {
    return {
      nodata: true,
      reason: ZeroStateReason.Zero,
    };
  }
  const severity = ['info', 'low', 'medium', 'high'];
  return {
    headers: [
      {name: 'Host Name', field: 'host_name', class: 'left'},
      {name: 'Count', field: 'count', class: 'right'},
      {name: 'Deployment', field: 'deployment_name', class: 'left'},
      {name: 'Worst Severity', field: 'status', class: 'left status'}
    ],
    body: hosts.map(host =>
      ({
        host_name: host[Column.HostName],
        count: host[Column.VulnerabilityCount],
        deployment_name: host[Column.DeploymentName],
        status: severity[host[Column.WorstSeverity]]
        // Cannot offer drill down here, since deployment_id is no longer being returned, need to clarify what the drill down action should be here!
        // recordLink: {
        //   deployment_id: host[0],
        //   host: host[2]
        // }
      })),
  };
};
