import * as Transformation from '../top-malware-attack-types.transformation';
import { ZeroStateReason } from '@al/ng-visualizations-components';
import { SummaryResponse, endpointResponse } from '../../tests/mocks/endpoint.mocks';
import { AlEEPMappingDictionary } from '@al/endpoints';

describe('Top Malware Attack Types Transformation Test Suite', () => {
  const mappings: AlEEPMappingDictionary = {
      rules: {
        MaliciousEXElaunched : {
          name: "Malicious EXE launched",
          description: "Malicious EXE launched",
          malwareStopped: []
        },
        FileModificationScan : {
          name: "File Modification Scan",
          description: "File Modification Scan",
          malwareStopped: []
        }
      }
  };
  describe('when there are no results', () => {
    it('should return a zero state reason for no results', () => {
      const response: SummaryResponse = Object.assign({},
        endpointResponse, {
        summary: {
          incidentTypes: []
        }
      });

      const config = Transformation.topMalwareAttackTypes([response, mappings]);
      expect(config).toEqual({
        nodata: true,
        reason: ZeroStateReason.Zero
      });
    });
  });
  describe('when there are results', () => {
    it('should return a correctly constructed table list configuration object', () => {
      const response: SummaryResponse = Object.assign({},
        endpointResponse, {
        summary: {
          incidentTypes: [{
            ruleName: 'MaliciousEXElaunched',
            protectCount: 80,
            monitoredCount: 0
          },{
            ruleName: 'FileModificationScan',
            protectCount: 20,
            monitoredCount: 0
          }]
        }
      });

      const config = Transformation.topMalwareAttackTypes([response, mappings]);
      expect(config).toEqual({
        headers: [
          { name: 'Malware Attack Type', field: 'name', class: 'left multiline-content' },
          { name: 'Event Count', field: 'count', class: 'right' },
          { name: '% of Total', field: 'percent', class: 'right' }
        ],
        body: [{
          name: 'Malicious EXE launched',
          count: 80,
          percent: '80.0%',
          recordLink: {
            search: 'Malicious EXE launched'
          }
        },{
          name: 'File Modification Scan',
          count: 20,
          percent: '20.0%',
          recordLink: {
            search: 'File Modification Scan'
          }
        }]
      });
    });
  });
});
