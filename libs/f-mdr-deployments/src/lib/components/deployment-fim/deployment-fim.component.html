<!-- Next step and description -->

<div fxLayout="row" class="under-line">
    <div fxFlex="70">
        <h1 i18n>{{title.page}}</h1>
    </div>
    <div fxFlex="30" fxLayoutAlign="end" fxFlexFill="0" >
        <button color="primary" mat-raised-button (click)="next()">NEXT</button>
    </div>
</div>

<span class="information">
    <p i18n>
      {{infoText}}
    </p>
</span>

<!-- Header and Toolbar -->
<al-content-header #header
    [title]="title.header"
    showAddButton="true"
    (onButtonClicked)="create()"
></al-content-header>

<al-content-toolbar #headerNavTool
    [config]="toolbarConfig"
    (onSearched)="search($event)"
    (onGroupSelection)="filter($event)"
    (onSelectAll)="selectAll($event)">
</al-content-toolbar>

<!-- Zero State -->
<al-view-helper #notificationPanel
    [empty]="!loading && !apiError && filteredGroups.length === 0">
    <i class="al al-application-set" zero-state-icon></i>
    <span zero-state-description i18n>
        The filters applied returned no results.
    </span>
</al-view-helper>

<!-- Error State -->
<al-view-helper [empty]="apiError"  [loading]="loading">
    <i class="material-icons" zero-state-icon>
        info
    </i>
    <span zero-state-description i18n>
        Requested source is not available at this moment
    </span>
</al-view-helper>

<div class="fim-list-cards" >
    <!-- List of Cards -->
    <div *ngFor="let itemGroup of filteredGroups" [(ngModel)]="filteredGroups" name="filteredGroups" ngDefaultControl>
        <div *ngFor="let fimGroup of itemGroup | keyvalue">
            <div *ngIf="fimGroup.value.list.length > 0">
                <div class="group-title">
                    <span>
                        <p-checkbox 
                            [(ngModel)]="fimGroup.value.selected"
                            [binary]="true"
                            (onChange)="selectGroupFromCheckbox(fimGroup.value.type, fimGroup.value.selected)">
                        </p-checkbox>
                    </span>
                    <span>{{fimGroup.value.label}}</span>
                </div>
                <div *ngFor="let item of fimGroup.value.list" [(ngModel)]="fimGroup.value.list" class="group-list" name="fimGroup" ngDefaultControl>
                    <deployment-fim-card
                        [cardItem]="item.item"
                        [assetsMap]="assetsMap"
                        [tagsMap]="tagsMap"
                        [selectedCard]="item.selected"
                        [usersMap]="usersMap"
                        [mode]="mode"
                        (onMonitorToggled)="monitor([$event])"
                        (onEditActionClicked)="edit($event)"
                        (onDeleteActionClicked)="delete($event)"
                        (onDuplicateActionClicked)="duplicate($event)"
                        (selectCard)="toggleCard(item,fimGroup.value.type)">
                    </deployment-fim-card>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- forms -->

<al-deployment-fim-form #fimForm
    [accountId]="accountId"
    [deploymentId]="deployment.id"
    [assetsMap]="assetsMap"
    [tagsMap]="tagsMap"
    [allowedAssetTypes]="allowedAssetTypes"
    [headerOptions]="deploymentFimFormHeaderOptions"
    [mode]="mode"
    (saveModal)="afterSavingConfig($event)"
></al-deployment-fim-form>

<al-deployment-fim-bulk-edit-scope-form #fimEditScopeForm
    [accountId]="accountId"
    [assetsMap]="assetsMap"
    [tagsMap]="tagsMap"
    [allowedAssetTypes]="allowedAssetTypes"
    [configurations]="configurations"
    [configurationsMap]="configurationsMap"
    [deploymentId]="deployment.id"
    [headerOptions]="deploymentFimBulkEditFormHeaderOptions"
    (saveModal)="afterSavingConfig(null)"
    [mode]="mode"
></al-deployment-fim-bulk-edit-scope-form>

<!-- snackbar -->
<al-action-snackbar 
    [text]="actionSnackbarText"
    [visible]="actionSnackbarVisible"
    [elements]="actionSnackbarElements"
    (onElementPressed)="doBulk($event)"
></al-action-snackbar>

<!-- delete confirm dialog -->
<p-confirmDialog #cd [header]="confirmDialogHeaderText">
    <p-footer>
        <button type="button" pButton class="flat" label="Cancel"
            (click)="cd.reject()"></button>

        <button type="button" pButton (click)="cd.accept()" label="DELETE"
            class="primaryAction"></button>
    </p-footer>
</p-confirmDialog>

